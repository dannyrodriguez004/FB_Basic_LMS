{
  "version": 3,
  "file": "cache.interceptor.js",
  "sources": [
    "ng://angular-interceptors/src/cache.interceptor.ts"
  ],
  "sourcesContent": [
    "import {HTTP_INTERCEPTORS, HttpEvent, HttpHandler, HttpInterceptor} from '@angular/common/http';\r\nimport {HttpRequest} from '@angular/common/http';\r\nimport {Inject, Injectable, InjectionToken, Optional} from '@angular/core';\r\nimport {interval, Observable, throwError} from 'rxjs';\r\nimport {catchError, finalize, publishReplay, refCount, take} from 'rxjs/operators';\r\n\r\nexport const MAX_AGE_MS = new InjectionToken<string>('maxAgeMs');\r\n\r\n@Injectable()\r\nexport class CacheInterceptor implements HttpInterceptor {\r\n  cache = new Map<string, Observable<HttpEvent<any>>>();\r\n\r\n  constructor(@Inject(MAX_AGE_MS) @Optional() public maxAgeMs) {}\r\n\r\n  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n    if (!this.isCachable(req)) {\r\n      return next.handle(req);\r\n    }\r\n\r\n    const cachedResponse = this.cache.get(req.urlWithParams);\r\n    if (cachedResponse) {\r\n      return cachedResponse;\r\n    }\r\n\r\n    const obs$ = next.handle(req).pipe(\r\n        finalize(\r\n            () => interval(this.maxAgeMs)\r\n                      .pipe(take(1))\r\n                      .subscribe(() => this.cache.delete(req.urlWithParams))),\r\n        publishReplay(), refCount(), catchError(err => throwError(err)));\r\n    this.cache.set(req.urlWithParams, obs$);\r\n\r\n    return obs$;\r\n  }\r\n\r\n  private isCachable(req: HttpRequest<any>) {\r\n    return req.method === 'GET' && !req.headers.get('disable-cache');\r\n  }\r\n}\r\n\r\nexport const CACHE_INTERCEPTOR_PROVIDER = {\r\n  provide: HTTP_INTERCEPTORS,\r\n  useClass: CacheInterceptor,\r\n  multi: true\r\n};\r\n"
  ],
  "names": [],
  "mappings": ";;;;AAAA,OAAO,EAAC,iBAAiB,EAA0C,MAAM,sBAAsB,CAAC;AAEhG,OAAO,EAAC,MAAM,EAAE,UAAU,EAAE,cAAc,EAAE,QAAQ,EAAC,MAAM,eAAe,CAAC;AAC3E,OAAO,EAAC,QAAQ,EAAc,UAAU,EAAC,MAAM,MAAM,CAAC;AACtD,OAAO,EAAC,UAAU,EAAE,QAAQ,EAAE,aAAa,EAAE,QAAQ,EAAE,IAAI,EAAC,MAAM,gBAAgB,CAAC;AAEnF,MAAM,CAAC,uBAAM,UAAU,GAAG,IAAI,cAAc,CAAS,UAAU,CAAC,CAAC;AAGjE,MAAM;;;;IAGJ,YAAmD;QAAA,aAAQ,GAAR,QAAQ;qBAFnD,IAAI,GAAG,EAAsC;KAEU;;;;;;IAE/D,SAAS,CAAC,GAAqB,EAAE,IAAiB;QAChD,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAC1B,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;QAED,uBAAM,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QACzD,EAAE,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;YACnB,MAAM,CAAC,cAAc,CAAC;SACvB;QAED,uBAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAC9B,QAAQ,CACJ,GAAG,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC;aAClB,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;aACb,SAAS,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC,CAAC,EACrE,aAAa,EAAE,EAAE,QAAQ,EAAE,EAAE,UAAU,CAAC,GAAG,CAAC,EAAE,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QACrE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;QAExC,MAAM,CAAC,IAAI,CAAC;KACb;;;;;IAEO,UAAU,CAAC,GAAqB;QACtC,MAAM,CAAC,GAAG,CAAC,MAAM,KAAK,KAAK,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;;;;YA5BpE,UAAU;;;;4CAII,MAAM,SAAC,UAAU,cAAG,QAAQ;;;;;;;;;;;;;;;AA4B3C,MAAM,CAAC,uBAAM,0BAA0B,GAAG;IACxC,OAAO,EAAE,iBAAiB;IAC1B,QAAQ,EAAE,gBAAgB;IAC1B,KAAK,EAAE,IAAI;CACZ,CAAC"
}
